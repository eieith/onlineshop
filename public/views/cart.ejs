<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('partials/head') %>
    <link rel="stylesheet" href="/css/display.css">
    <title>Cart | KAZ Handmade Shop</title>
</head>
<body>
    <!-- Header Section -->
    <header>
        <div id="logo">
            <h1>KAZ</h1>
            <h2>Handmade Shop</h2>
            <p>Your one-stop shop for handmade items</p>
        </div>
        <nav>
            <ul id="nav">
                <li><a href="/">Home</a></li>
                <li><a href="/display">Items</a></li>
                <li><a href="/cart" class="active">Cart</a></li>
                <li><a href="/review">Review</a></li>
            </ul>
        </nav>
    </header>

    <!-- Cart Section -->
    <main id="cartContainer">
        <h2>Your Cart</h2>
        <ul id="cartItemsList"></ul>
        <p><strong>Total:</strong> $<span id="totalPrice">0</span></p>
        <button id="checkoutBtn">Checkout</button>
        <button id="clearCartBtn">Clear Cart</button>
    </main>

    <!-- Receipt Modal -->
    <div id="receiptModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeReceipt()">&times;</span>
            <h2>Receipt</h2>
            <ul id="receiptItemsList"></ul>
            <p><strong>Total Paid:</strong> $<span id="receiptTotalPrice">0</span></p>
            <p>Thank you for shopping with us!</p>
        </div>
    </div>

    <!-- Footer Section -->
    <footer>
        <p>&copy; 2024 KAZ Handmade Shop. All Rights Reserved.</p>
    </footer>

    <!-- JavaScript -->
    <script>
        let cart = JSON.parse(localStorage.getItem('cart')) || [];

        // Function to display cart items
        function displayCart() {
            const cartItemsList = document.getElementById('cartItemsList');
            const totalPriceElement = document.getElementById('totalPrice');

            // Clear existing items
            cartItemsList.innerHTML = '';
            let total = 0;

            // Populate items
            cart.forEach((item, index) => {
                const listItem = document.createElement('li');
                listItem.innerText = `${item.name} - $${item.price}`;
                cartItemsList.appendChild(listItem);
                total += parseFloat(item.price);
            });

            totalPriceElement.innerText = total.toFixed(2);
        }

        // Checkout function
        function checkout() {
            if (cart.length === 0) {
                alert('Your cart is empty! Add some items before checkout.');
                return;
            }

            // Generate receipt
            const receiptItemsList = document.getElementById('receiptItemsList');
            const receiptTotalPrice = document.getElementById('receiptTotalPrice');

            receiptItemsList.innerHTML = '';
            let total = 0;

            cart.forEach((item) => {
                const listItem = document.createElement('li');
                listItem.innerText = `${item.name} - $${item.price}`;
                receiptItemsList.appendChild(listItem);
                total += parseFloat(item.price);
            });

            receiptTotalPrice.innerText = total.toFixed(2);

            // Show receipt modal
            document.getElementById('receiptModal').style.display = 'block';

            // Clear cart
            clearCart();
        }

        // Clear cart function
        function clearCart() {
            localStorage.removeItem('cart'); // Remove from localStorage
            cart = []; // Clear array
            displayCart(); // Update the UI
        }

        // Close receipt modal
        function closeReceipt() {
            document.getElementById('receiptModal').style.display = 'none';
        }

        // Attach event listeners
        document.getElementById('checkoutBtn').addEventListener('click', checkout);
        document.getElementById('clearCartBtn').addEventListener('click', clearCart);

        // Display the cart on page load
        displayCart();
    </script>
</body>
</html>
